{{ 'section-countdown.css' | asset_url | stylesheet_tag: preload: true }}

{%- liquid

  assign section_padding = ''
  if section.settings.section_padding == 'top'
    assign section_padding = 'mb0'
  elsif section.settings.section_padding == 'bottom'
    assign section_padding = 'mt0'
  elsif section.settings.section_padding == 'none'
    assign section_padding = 'mt0 mb0'
  endif

  if section.settings.full_width
    assign full_width =  'edge'
  endif

  assign layout = 'center'
  if section.settings.layout == 'split'
    assign layout = 'space-between'
  elsif section.settings.layout == 'stack'
    assign layout = 'flex-row'
  endif

  assign has_image = false
  if section.settings.image != blank
    assign has_image = true
  endif

  assign overlay_opacity = section.settings.overlay_opacity | plus: 0 | divided_by: 100.0

  for block in section.blocks
    case block.type

      when 'countdown'

        assign year = block.settings.year
        assign month = block.settings.month
        assign day = block.settings.day
        assign hour = block.settings.hour
        assign minute = block.settings.minute

        assign date_now = "now" | date: "%s"
        assign countdown_date = month | append: ' ' | append: day | append: ',' | append: ' ' | append: year | append: ' ' | append: hour | append: ':' | append: minute | append: ':' | append: '00'
        assign sale_date = countdown_date | date: "%s"

        assign timestamp = sale_date

        assign on_sale = false
        assign after_countdown_message = block.settings.after_countdown_message

        if sale_date > date_now
          assign on_sale = true
        endif

        assign button_text = block.settings.countdown_button | escape
        assign link = block.settings.countdown_link

        assign has_button = false
        if link != blank and button_text != blank
          assign has_button = true
        endif

      when 'text'

        assign rich_text = block.settings.countdown_text

    endcase
  endfor

  if section.index == 1
    assign loading = 'eager'
    assign fetch_priority = 'high'
  endif

-%}

{% style %}
#shopify-section-{{ section.id }} {
  --background: {{ section.settings.background_color }};
  --text-color: {{ section.settings.text_color }};
  --button-text: {{ section.settings.button_color }};
  --button-color: {{ section.settings.button_background }};
  --desktop-section-height: {{ section.settings.desktop_height }}px;
  --mobile-section-height: {{ section.settings.mobile_height }}px;
  --section-overlay-color: {{ section.settings.overlay_color | color_modify: 'alpha', overlay_opacity }};
  --text-size: {{ section.settings.text_size }}px;
  --clock-text-size: {{ section.settings.clock_text_size }}px;
}
{% endstyle %}


<div class="global__section section-countdown global__section--margin {{ section_padding }}""
  data-section-id="{{ section.id }}"
  data-section-type="countdown"
  data-base-url="{{ shop.url}}{{ routes.root_url }}"
  data-launch-date="{{ timestamp }}"
  data-aos="{{ settings.scroll_animation }}"
  >

  <div class="countdown--content_container{% if has_image %} has--image{% endif %} row grid__wrapper rg0 pl0 pr0 {{ full_width }}">
    {% if section.settings.image %}
      <div class="countdown__image span-12 auto">
        {% render 'basic-responsive-image', type: section.settings.image, width: 3000, loading: loading, fetchpriority: fetch_priority %}
      </div>
    {% endif %}
    <div id="countdownWrapper" class="countdown__wrapper span-12 auto{% if has_image %} has--image{% endif %} position-{{ section.settings.content_position }}">
      <div class="countdown__grid l-{{ layout }}">
        {% for block in section.blocks %}

          {% if block.type == 'countdown' %}
            <div class="countdown__time-container" 
              data-aos="{{ settings.scroll_animation }}"
              data-aos-delay="{{ forloop.index | times: 100 }}"
              {{ block.shopify_attributes }}>
              {% if on_sale %}
                <div class="countdown__time--wrapper a-center">
                  <p class="countdown__time mb0" data-launch-days>00</p>
                  <p class="countdown__time-label mb0">{{ 'sections.countdown.days' | t }}</p>
                  <span class="countdown__colon-divider">:</span>
                </div>
                <div class="countdown__time--wrapper a-center">
                  <p class="countdown__time mb0" data-launch-hours>00</p>
                  <p class="countdown__time-label mb0">{{ 'sections.countdown.hours' | t }}</p>
                  <span class="countdown__colon-divider">:</span>
                </div>
                <div class="countdown__time--wrapper a-center">
                  <p class="countdown__time mb0" data-launch-mins>00</p>
                  <p class="countdown__time-label mb0">{{ 'sections.countdown.mins' | t }}</p>
                  <span class="countdown__colon-divider">:</span>
                </div>
                <div class="countdown__time--wrapper a-center">
                  <p class="countdown__time mb0" data-launch-secs>00</p>
                  <p class="countdown__time-label mb0">{{ 'sections.countdown.secs' | t }}</p>
                </div>
              {% else %}
                  <p class="mb0">{{ after_countdown_message }}</p>
              {% endif %}
              {% if has_button %}
                <div class="countdown__button-wrapper">
                  <a class="button mb0" href="{{ link }}">{{ button_text }}</a>
                </div>
              {% endif %}
            </div>
          {% endif %}

          {% if block.type == 'text' %}
            <div class="countdown__heading rte block-{{ block.id }}"
              data-aos="{{ settings.scroll_animation }}"
              data-aos-delay="{{ forloop.index | times: 100 }}"
              {{ block.shopify_attributes }}>
                {% if rich_text != blank %}
                  {{ rich_text }}
                {% endif %}
            </div>
          {% endif %}
        {% endfor %}
      </div>
    </div>
  </div>

  {% if on_sale == false %}
    {% if section.settings.hide_after_countdown %}
      <style>
        #shopify-section-{{ section.id }} {
          display: none;
        }
      </style>
    {% endif %}
  {% endif %}

</div>

{% schema %}
{
  "name": "Countdown",
  "limit":1,
  "settings": [
  {
    "type": "paragraph",
    "content": "Show a countdown time with optional text and a button"
  },
  {
    "type": "checkbox",
    "id": "full_width",
    "label": "Enable full width",
    "default":true
  },
  {
    "type": "radio",
    "id": "layout",
    "label": "Layout",
    "options": [
      {
        "value": "center",
        "label": "Center"
      },
      {
        "value": "split",
        "label": "Split"
      },
      {
        "value": "stack",
        "label": "Stack"
      }
    ],
    "default": "center"
  },
  {
    "type": "checkbox",
    "id": "hide_after_countdown",
    "label": "Hide when countdown ends",
    "default":true
  },
  {
    "type":"header",
    "content":"Image"
  },
  {
    "type": "image_picker",
    "id": "image",
    "label": " Background image",
    "info": "2880px x 800px recommended"
  },
  {
    "type": "range",
    "id": "desktop_height",
    "min": 200,
    "max": 500,
    "step": 100,
    "unit": "px",
    "label": "Desktop image height",
    "default": 200
  },
  {
    "type": "range",
    "id": "mobile_height",
    "min": 200,
    "max": 500,
    "step": 100,
    "unit": "px",
    "label": "Mobile image height",
    "default": 200
  },
  {
    "type": "color",
    "id": "overlay_color",
    "label": "Overlay color",
    "default": "#000000"
  },
  {
    "type": "range",
    "id": "overlay_opacity",
    "min": 0,
    "max": 100,
    "step": 1,
    "unit": "%",
    "label": "Overlay opacity",
    "default": 0
  },
  {
    "type":"header",
    "content":"Content"
  },
  {
    "type": "range",
    "id": "text_size",
    "min": 12,
    "max": 72,
    "step": 1,
    "unit": "px",
    "label": "Text size",
    "default": 14
  },
  {
    "type": "range",
    "id": "clock_text_size",
    "min": 12,
    "max": 72,
    "step": 1,
    "unit": "px",
    "label": "Clock text size",
    "default": 14
  },
  {
    "type": "select",
    "id": "content_position",
    "label": "Content position",
    "options": [
      {
        "value": "start",
        "label": "Top"
      },
      {
        "value": "center",
        "label": "Center"
      },
      {
        "value": "end",
        "label": "Bottom"
      }
    ],
    "default": "center"
  },
  {
    "type": "color",
    "id": "background_color",
    "label": "Background",
    "default": "#000000"
  },
  {
    "type": "color",
    "id": "text_color",
    "label": "Text color",
    "default": "#ffffff"
  },
  {
    "type": "color",
    "id": "button_color",
    "label": "Button text",
    "default": "#ffffff"
  },
  {
    "type": "color",
    "id": "button_background",
    "label": "Button background",
    "default": "#000000"
  },
  {
    "type": "select",
    "id": "section_padding",
    "label": "Section spacing",
    "options": [
      {
        "value": "top",
        "label": "Top"
      },
      {
        "value": "bottom",
        "label": "Bottom"
      },
      {
        "value": "both",
        "label": "Both"
      },
      {
        "value": "none",
        "label": "None"
      }
    ],
    "default": "none"
  }
  ],
  "blocks": [
    {
      "name": "Timer",
      "limit":1,
      "type":"countdown",
      "settings": [
        {
          "type": "select",
          "id": "year",
          "label": "Year",
          "options": [
            {
              "value": "2024",
              "label": "2024"
            },
            {
              "value": "2025",
              "label": "2025"
            },
            {
              "value": "2026",
              "label": "2026"
            }
          ],
          "default": "2024"
        },
        {
          "type": "select",
          "id": "month",
          "label": "Month",
          "options": [
            {
              "value": "january",
              "label": "January"
            },
            {
              "value": "february",
              "label": "February"
            },
            {
              "value": "march",
              "label": "March"
            },
            {
              "value": "april",
              "label": "April"
            },
            {
              "value": "may",
              "label": "May"
            },
            {
              "value": "june",
              "label": "June"
            },
            {
              "value": "july",
              "label": "July"
            },
            {
              "value": "august",
              "label": "August"
            },
            {
              "value": "september",
              "label": "September"
            },
            {
              "value": "october",
              "label": "October"
            },
            {
              "value": "november",
              "label": "November"
            },
            {
              "value": "december",
              "label": "December"
            }
          ],
          "default": "december"
        },
        {
          "type": "select",
          "id": "day",
          "label": "Day",
          "options": [
            {
              "value": "1",
              "label": "1"
            },
            {
              "value": "2",
              "label": "2"
            },
            {
              "value": "3",
              "label": "3"
            },
            {
              "value": "4",
              "label": "4"
            },
            {
              "value": "5",
              "label": "5"
            },
            {
              "value": "6",
              "label": "6"
            },
            {
              "value": "7",
              "label": "7"
            },
            {
              "value": "8",
              "label": "8"
            },
            {
              "value": "9",
              "label": "9"
            },
            {
              "value": "10",
              "label": "10"
            },
            {
              "value": "11",
              "label": "11"
            },
            {
              "value": "12",
              "label": "12"
            },
            {
              "value": "13",
              "label": "13"
            },
            {
              "value": "14",
              "label": "14"
            },
            {
              "value": "15",
              "label": "15"
            },
            {
              "value": "16",
              "label": "16"
            },
            {
              "value": "17",
              "label": "17"
            },
            {
              "value": "18",
              "label": "18"
            },
            {
              "value": "19",
              "label": "19"
            },
            {
              "value": "20",
              "label": "20"
            },
            {
              "value": "21",
              "label": "21"
            },
            {
              "value": "22",
              "label": "22"
            },
            {
              "value": "23",
              "label": "23"
            },
            {
              "value": "24",
              "label": "24"
            },
            {
              "value": "25",
              "label": "25"
            },
            {
              "value": "26",
              "label": "26"
            },
            {
              "value": "27",
              "label": "27"
            },
            {
              "value": "28",
              "label": "28"
            },
            {
              "value": "29",
              "label": "29"
            },
            {
              "value": "30",
              "label": "30"
            },
            {
              "value": "31",
              "label": "31"
            }
          ],
          "default": "31"
        },
        {
          "type": "select",
          "id": "hour",
          "label": "Hour",
          "options": [
            {
              "value": "0",
              "label": "12 AM"
            },
            {
              "value": "01",
              "label": "01 AM"
            },
            {
              "value": "02",
              "label": "02 AM"
            },
            {
              "value": "03",
              "label": "03 AM"
            },
            {
              "value": "04",
              "label": "04 AM"
            },
            {
              "value": "05",
              "label": "05 AM"
            },
            {
              "value": "06",
              "label": "06 AM"
            },
            {
              "value": "07",
              "label": "07 AM"
            },
            {
              "value": "08",
              "label": "08 AM"
            },
            {
              "value": "09",
              "label": "09 AM"
            },
            {
              "value": "10",
              "label": "10 AM"
            },
            {
              "value": "11",
              "label": "11 AM"
            },
            {
              "value": "12",
              "label": "12 PM"
            },
            {
              "value": "13",
              "label": "1 PM"
            },
            {
              "value": "14",
              "label": "2 PM"
            },
            {
              "value": "15",
              "label": "3 PM"
            },
            {
              "value": "16",
              "label": "4 PM"
            },
            {
              "value": "17",
              "label": "5 PM"
            },
            {
              "value": "18",
              "label": "6 PM"
            },
            {
              "value": "19",
              "label": "7 PM"
            },
            {
              "value": "20",
              "label": "8 PM"
            },
            {
              "value": "21",
              "label": "9 PM"
            },
            {
              "value": "22",
              "label": "10 PM"
            },
            {
              "value": "23",
              "label": "11 PM"
            }
          ],
          "default": "12"
        },
        {
          "type": "select",
          "id": "minute",
          "label": "minute",
          "options": [
            {
              "value": "0",
              "label": "0"
            },
            {
              "value": "05",
              "label": "5"
            },
            {
              "value": "10",
              "label": "10"
            },
            {
              "value": "15",
              "label": "15"
            },
            {
              "value": "20",
              "label": "20"
            },
            {
              "value": "25",
              "label": "25"
            },
            {
              "value": "30",
              "label": "30"
            },
            {
              "value": "35",
              "label": "35"
            },
            {
              "value": "40",
              "label": "40"
            },
            {
              "value": "45",
              "label": "45"
            },
            {
              "value": "50",
              "label": "50"
            },
            {
              "value": "55",
              "label": "55"
            }
          ],
          "default": "0"
        },
        {
          "type": "text",
          "id": "countdown_button",
          "label": "Button",
          "default": "Shop now"
         },
         {
          "type": "url",
          "id": "countdown_link",
          "label": "Link"
         },
        {
          "type": "text",
          "id": "after_countdown_message",
          "label": "After countdown message",
          "default": "Countdown has ended"
        }
      ]
    },
    {
      "name": "Text",
      "type":"text",
      "limit": 1,
      "settings": [
        {
          "type": "richtext",
          "id": "countdown_text",
          "label": "Text",
          "default": "<p>Add urgency to a store event</p>"
        }
      ]
    }
  ],
  "presets": [{
    "name": "Countdown",
    "blocks": [{
        "type": "text",
        "settings": {
          "countdown_text": "<p>Add urgency to a store event<\/p>"
        }
      },
      {
        "type": "countdown",
        "settings": {
          "year": "2023",
          "month": "december",
          "day": "31",
          "hour": "12",
          "minute": "0",
          "after_countdown_message": "Countdown has ended"
        }
      }
    ]
  }
 ]
}
{% endschema %}
