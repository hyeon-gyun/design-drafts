{{ 'section-slideshow.css' | asset_url | stylesheet_tag: preload: true }}

{%- liquid
  if section.settings.enable_autoplay
    assign slider_speed = section.settings.slider_speed | times: 1000
  else
    assign slider_speed = false
  endif

  assign section_padding = ''
  if section.settings.section_padding == 'top'
    assign section_padding = 'mb0'
  elsif section.settings.section_padding == 'bottom'
    assign section_padding = 'mt0'
  elsif section.settings.section_padding == 'none'
    assign section_padding = 'mt0 mb0'
  endif

  assign enough_to_wrap = false
  if section.blocks.size > 1
    assign enough_to_wrap = true
  endif

  assign is_fixed_height = false
  case section.settings.slideshow_size
    when 'natural'
      assign slideshow_size = 'is-natural'
    when 'first_image'
      assign slideshow_size = 'is-first-image'
    when 'fixed_height'
      assign slideshow_size = 'is-fixed-height'
      assign desktop_height = section.settings.desktop_height
      assign mobile_height = section.settings.mobile_height
      assign is_fixed_height = true
  endcase

-%}
{% style %}

  #shopify-section-{{ section.id }} {
    --font-size:  {{ section.settings.subheading_size }}px;
    --h2-size:  {{ section.settings.slide_heading_size }}px;
    --slider-speed: {{ slider_speed }}ms;
    {% if is_fixed_height %}
      --desktop-section-height: {{ desktop_height }}px;
      --mobile-section-height: {{ mobile_height }}px;
    {% endif %}
  }
  #slideshow--{{ section.id }} .slideshow__btn-wrapper a {
    font-size: {{ section.settings.cta_size }}px;
  }
  @media (max-width: 740px) {
     #shopify-section-{{ section.id }} {
       --font-size: calc({{ section.settings.subheading_size }}px - ({{ section.settings.subheading_size }}px * 0.15));
       --h2-size: calc({{ section.settings.slide_heading_size }}px - ({{ section.settings.slide_heading_size }}px * 0.15));
     }
     #slideshow--{{ section.id }} .slideshow__btn-wrapper a {
       font-size: calc({{ section.settings.cta_size }}px - ({{ section.settings.cta_size }}px * 0.15));
     }
   }
  {% for block in section.blocks %}
    {% assign block_opacity = block.settings.overlay_opacity | plus: 0 | divided_by: 100.0%}
    #slide--{{ block.id }} {
        --section-overlay-color: {{ block.settings.overlay_color | color_modify: 'alpha', block_opacity }};
        --background: {{ block.settings.caption_background }};
        --text-color: {{ block.settings.slide_text_color }};
        --button-text: {{ block.settings.cta_color }};
        --button-color: {{ block.settings.cta_background }};
        --button-hover: {{ block.settings.cta_background_hover }};
    }
  {% endfor %}

{% endstyle %}
<section
  class="slideshow-section global__section global__section--margin {{ section_padding }}"
  data-section-id="{{ section.id }}"
  data-section-type="slideshow-section"
  data-aos="{{ settings.scroll_animation }}"
  data-video-wrapper>

  {% capture slideshow_config %}{
    "wrapAround":{{ enough_to_wrap }},
    "dragThreshold":"15",
    "pauseAutoPlayOnHover":false,
    "autoPlay": {{ slider_speed }},
    "fade": true,
    "adaptiveHeight": true,
    "pageDots":{% if section.settings.pager != 'arrows' and enough_to_wrap %}true{% else %}false{% endif %},
    "prevNextButtons":{% if section.settings.pager == 'arrows' and enough_to_wrap %}true{% else %}false{% endif %}
  }{% endcapture %}

  {% if section.blocks.size > 0 %}
    <div class="slideshow flickity__section js-slideshow {{ slideshow_size }} slide--nav-{{ section.settings.pager }}" id="slideshow--{{ section.id }}" data-video-audio="{{ section.settings.video_audio }}" data-flickity='{{ slideshow_config }}'>
      {% for block in section.blocks %}
        {%- case block.type -%}
          {%- when 'video' -%}
            {% render 'snip-slide-video'
              section: section,
              block: block,
              index: forloop.index0,
              slideshow_size: section.settings.slideshow_size,
              caption_below: section.settings.caption_below
            %}
          {%- when 'image' -%}
            {% render 'snip-slide-image'
              section: section,
              block: block,
              index: forloop.index0,
              slideshow_size: section.settings.slideshow_size,
              caption_below: section.settings.caption_below
            %}
          {% endcase %}
      {% endfor %}
    </div>
  {% endif %}
</section>


{% schema %}
{
  "name": "Slideshow",
  "max_blocks": 5,
  "blocks":
  [
    {
      "type": "image",
      "name": "Image slide",
      "settings":
      [
        {
          "type": "header",
          "content": "Desktop Settings"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": " Desktop image",
          "info": "2880px x 1620px recommended"
        },
        {
          "type": "color",
          "id": "overlay_color",
          "label": "Overlay color",
          "default": "#000000"
        },
        {
          "type": "range",
          "id": "overlay_opacity",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "%",
          "label": "Overlay opacity",
          "default": 0
        },
        {
          "type": "header",
          "content": "Mobile Settings"
        },
        {
          "type": "image_picker",
          "id": "mobile_image",
          "label": "Mobile image",
          "info": "800px x 1200px recommended"
        },
        {
          "type": "header",
          "content": "Caption Content"
        },
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "Slide image title"
        },
        {
          "type": "richtext",
          "id": "subheading",
          "label": "Subheading",
          "default": "<p>Slide image subheading</p>"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link"
        },
        {
          "type": "text",
          "id": "button_text",
          "label": "Button text",
          "default": "Button",
          "info": "Visible only if a link is chosen"
        },
        {
          "type": "url",
          "id": "second_link",
          "label": "Button 2 link"
        },
        {
          "type": "text",
          "id": "second_button_text",
          "label": "Button 2 text",
          "info": "Visible only if 2nd link is chosen"
        },
        {
          "type": "header",
          "content": "Caption styles"
        },
        {
          "type": "text_alignment",
          "id": "text_align",
          "label": "Caption alignment",
          "default": "center"
        },
        {
          "type": "checkbox",
          "id": "subheading_first",
          "label": "Invert heading and subheading",
          "default":false
        },
        {
          "type": "color",
          "id": "slide_text_color",
          "label": "Heading and subheading",
          "default": "#ffffff"
        },
        {
          "type": "color",
          "id": "cta_color",
          "label": "Button text",
          "default": "#ffffff"
        },
        {
          "type": "color",
          "id": "cta_background",
          "label": "Button background",
          "default": "#000000"
        },
        {
          "type": "color",
          "id": "cta_background_hover",
          "label": "Button background hover",
          "default": "#000000"
        },
        {
          "type": "color",
          "id": "caption_background",
          "label": "Caption background",
          "default": "transparent"
        },
        {
          "type": "header",
          "content": "Caption positioning"
        },
        {
          "type": "range",
          "id": "caption_horizontal",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "%",
          "label": "Caption horizontal position",
          "default": 50
        },
        {
          "type": "range",
          "id": "caption_vertical",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "%",
          "label": "Caption vertical position",
          "default": 50
        }
      ]
    },
    {
      "type": "video",
      "name": "Video slide",
      "settings":
      [
        {
          "id": "video_url",
          "type": "video_url",
          "label": "Video URL",
          "accept":
          [
            "youtube",
            "vimeo"
          ],
          "default": "https://www.youtube.com/watch?v=_9VUPq3SxOc"
        },
        {
          "type": "video",
          "id": "video_url_mp4",
          "label": "A Shopify-hosted video"
        },
        {
          "type": "image_picker",
          "id": "poster_image",
          "label": "Poster image",
          "info": "2880px x 1620px recommended. Only appears for MP4 video."
        }
      ]
    }
  ],
  "settings":
  [
    {
      "type": "checkbox",
      "id": "enable_autoplay",
      "label": "Auto-change slides",
      "default": false
    },
    {
      "type": "range",
      "id": "slider_speed",
      "min": 3,
      "max": 10,
      "step": 1,
      "unit": "sec",
      "label": "Change slide every",
      "default": 5
    },
    {
      "type": "select",
      "id": "pager",
      "label": "Navigation style",
      "options":
      [
        {
          "value": "arrows",
          "label": "Arrows"
        },
        {
          "value": "bars",
          "label": "Bars"
        },
        {
          "value": "dots",
          "label": "Dots"
        }
      ]
    },
    {
      "type": "select",
      "id": "video_audio",
      "label": "Video audio",
      "default": "off",
      "options":
      [
        {
          "value": "off",
          "label": "Off"
        },
        {
          "value": "on",
          "label": "On"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": "Set the height of your slideshow. The first image and fixed height settings offer improved performance, and CLS scores."
    },
    {
      "type": "select",
      "id": "slideshow_size",
      "label": "Slide height",
      "options": [
        {
          "value": "natural",
          "label": "Natural"
        },
        {
          "value":"first_image",
          "label": "First image"
        },
        {
          "value": "fixed_height",
          "label": "Fixed height"
        }
      ],
      "default":"first_image"
    },
    {
      "type": "range",
      "id": "desktop_height",
      "min": 200,
      "max": 1000,
      "step": 100,
      "unit": "px",
      "label": "Desktop fixed height",
      "default": 900
    },
    {
      "type": "range",
      "id": "mobile_height",
      "min": 200,
      "max": 1000,
      "step": 100,
      "unit": "px",
      "label": "Mobile fixed height",
      "default": 600
    },
    {
      "type": "header",
      "content": "Slideshow captions"
    },
    {
      "type": "checkbox",
      "id": "caption_below",
      "label": "Below image on mobile"
    },
    {
      "type": "range",
      "id": "slide_heading_size",
      "min": 12,
      "max": 72,
      "step": 1,
      "unit": "px",
      "label": "Heading size",
      "default": 22
    },
    {
      "type": "range",
      "id": "subheading_size",
      "min": 12,
      "max": 48,
      "step": 1,
      "unit": "px",
      "label": "Caption size",
      "default": 14
    },
    {
      "type": "range",
      "id": "cta_size",
      "min": 12,
      "max": 36,
      "step": 1,
      "unit": "px",
      "label": "Button text size",
      "default": 14
    },
    {
      "type": "select",
      "id": "section_padding",
      "label": "Section spacing",
      "options": [
        {
          "value": "top",
          "label": "Top"
        },
        {
          "value": "bottom",
          "label": "Bottom"
        },
        {
          "value": "both",
          "label": "Both"
        },
        {
          "value": "none",
          "label": "None"
        }
      ],
      "default": "both"
    }
  ],
  "presets":
  [
    {
      "name": "Slideshow",
      "blocks":
      [
        {
          "type": "image"
        },
        {
          "type": "image"
        }
      ]
    }
  ],
  "disabled_on": {
    "groups":
    ["header","footer"]
  }
}
{% endschema %}
